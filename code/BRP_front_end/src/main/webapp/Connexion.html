<!DOCTYPE html>
<html>
<head>
	<title>Connexion</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
        
	<!-- Bootstrap -->
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        
        <link rel="stylesheet" href="style/style.css" />

	<!-- jquery -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body id="clientbody">
    <div id="conteneur_connection">
        <div class="sidenav">
            <div class="login-main-text">
                <h2>Page de connexion</h2>
            </div>
        </div>
        <div class="main">
            <div class="col-md-6 col-sm-12">
                <div class="login-form">
                    <form action="#">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="mail" id="Email">
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" placeholder="mot de passe" id="Password">
                        </div>
                        <div id="conteneur_button">
                            <button onclick="connexion()" class="btn btn-black" id="blogin_button">Connexion</button>
                            <button onclick="location.href='Inscription.html';" class="btn btn-secondary" >Créer un compte</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="error_notif" style="display: none;">
        Erreur : identifiant / mot de passe incorrects
    </div>
    <script>
        
        $.ajax({
          url: "./ActionServlet",
          method: "POST",
          data: {
            todo: "testConnection",
          },
          dataType: "json"
        }).done(function(response) {
            // Fonction appelée en cas d'appel AJAX réussi
            console.log("Response", response); // LOG dans Console Javascript
            if (!response.Error) { //Si déjà connecté alors on redirige vers son dashboard
                window.location.href = "Dashboard.html";
            }
        }).fail(function(error) {
            // Fonction appelée en cas d'erreur lors de l'appel AJAX
            console.log("Error", error); // LOG dans Console Javascript
            alert("Erreur lors de l'appel AJAX");
        });
        
        function connexion(){
            // Fonction appelée lors du clic sur le bouton de login
            console.log("clic sur le bouton de login"); // LOG dans Console Javascript

            // Récupération de la valeur des champs du formulaire
            var emailField = $("#Email").val();
            var passwordField = $("#Password").val();

            // Appel AJAX
            $.ajax({
              url: "./ActionServlet",
              method: "POST",
              data: {
                todo: "connection",
                email: emailField,
                password: passwordField
              },
              dataType: "json"
            }).done(function(response) {
                // Fonction appelée en cas d'appel AJAX réussi
                console.log("Response", response); // LOG dans Console Javascript
                if (!response.Error) {
                    window.location.href = "Dashboard.html";
                } else {
                    $("#error_notif").css("display", "block"); // Message pour le paragraphe de notification
                }
            }).fail(function(error) {
                // Fonction appelée en cas d'erreur lors de l'appel AJAX
                console.log("Error", error); // LOG dans Console Javascript
                alert("Erreur lors de l'appel AJAX");
            });
        }
    </script>
</body>
</html>