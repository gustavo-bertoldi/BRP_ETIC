<!DOCTYPE html>
<html>
  <head>
    <title>Gestion des projets - BRP</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style/style.css" />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"
    ></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div class="container">
        <div id="nomProjet" onclick="display_manage_project()">
          <div class="nomProjet">Nom projet</div>
          <div class="nomProjet"><i class="fas fa-chevron-down"></i></div>
        </div>
        <div id="manageProjet">
          <input type="text" id="search_input" placeholder="Chercher projet" />
          <div class="lineProjet">
            <div class="iconProjet"><i class="far fa-file-alt"></i></div>
            <div class="propositionNomProjet">Projet 1</div>
            <select class="actionProjet">
              <option value="ouvrir">Ouvrir</option>
              <option value="dupliquer">Dupliquer</option>
            </select>
          </div>
          <div class="lineProjet">
            <div class="iconProjet"><i class="far fa-file-alt"></i></div>
            <div class="propositionNomProjet">Projet 1</div>
            <select class="actionProjet">
              <option value="ouvrir">Ouvrir</option>
              <option value="dupliquer">Dupliquer</option>
            </select>
          </div>
          <div class="lineProjet">
            <div class="iconProjet"><i class="far fa-file-alt"></i></div>
            <div class="propositionNomProjet">Projet 1</div>
            <select class="actionProjet">
              <option value="ouvrir">Ouvrir</option>
              <option value="dupliquer">Dupliquer</option>
            </select>
          </div>
          <div class="lineProjet">
            <div class="iconProjet"><i class="far fa-plus-square"></i></div>
            <div class="propositionNomProjet">Nouveau projet</div>
          </div>
        </div>
        <div id="menu">
          <div class="menu menuBiblio" onclick="gestion_menu_bdd('biblio');">
            Bibliothèque
          </div>
          <div class="menu menuInfos" onclick="gestion_menu_bdd('infos');">
            Infos projet
          </div>
        </div>
        <div id="arboBDD">
          <select class="filtre" onchange="apply_filter();">
            <option value="">Sélectionnez un filtre</option>
            <option value="generique">Génériques</option>
            <option value="ouvrage">Ouvrages</option>
            <option value="prestation">Prestations</option>
          </select>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineCategorie">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Categorie AAA</div>
          </div>
          <div class="lineBDD lineFamille">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Famille 1</div>
          </div>
          <div class="lineBDD lineSousFamille">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">SousFamille 1</div>
          </div>
          <div class="lineBDD lineDescriptif generique">
            <input type="hidden" class="idDescriptif" value="01_AAA_01_01_01" />
            <span class="iconBDD">-</span>
            <div class="intitule">Générique</div>
          </div>
          <div class="lineBDD lineDescriptif ouvrage">
            <input type="hidden" class="idDescriptif" value="01_AAA_01_01_02" />
            <span class="iconBDD">-</span>
            <div class="intitule">Ouvrage</div>
          </div>
          <div class="lineBDD lineDescriptif prestation">
            <input
              type="hidden"
              class="idDescriptif"
              value="01_AAA_01_01_01_01"
            />
            <span class="iconBDD">-</span>
            <div class="intitule">Prestation</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
          <div class="lineBDD lineChapitre">
            <span class="iconBDD"
              ><i class="fas fa-caret-right arrow"></i
            ></span>
            <div class="intitule">Chapitre 1</div>
          </div>
        </div>
        <div id="infosProjet">
          <div class="infoProjet">
            <div class="titleInfo">Type de marché</div>
            <div class="valueInfo">
              <input
                class="radioOption"
                type="radio"
                name="typeMarche"
                value="marchePublic"
              />
              <label for="marchePublic">Public</label>
              <input
                class="radioOption"
                type="radio"
                name="typeMarche"
                value="marchePrive"
              />
              <label for="marchePrive">Privé</label>
            </div>
          </div>
          <div class="infoProjet">
            <div class="titleInfo">Type de construction</div>
            <div class="valueInfo">
              <input
                class="radioOption"
                type="radio"
                name="typeConstruction"
                value="neuf"
              />
              <label for="neuf">Neuf</label>
              <input
                class="radioOption"
                type="radio"
                name="typeConstruction"
                value="renovation"
              />
              <label for="renovation">Rénovation</label>
            </div>
          </div>
          <div class="infoProjet">
            <div class="titleInfo">Type de lots</div>
            <div class="valueInfo">
              <input
                class="radioOption"
                type="radio"
                name="typeLots"
                value="lotSepare"
              />
              <label for="lotSepare">Lots séparés</label>
              <input
                class="radioOption"
                type="radio"
                name="typeLots"
                value="entrepriseGenerale"
              />
              <label for="entrepriseGenerale">Entreprise générale</label>
            </div>
          </div>
          <div class="infoProjet">
            <div class="titleInfo">Site</div>
            <div class="valueInfo">
              <input
                class="radioOption"
                type="radio"
                name="typeSite"
                value="libre"
              />
              <label for="libre">Libre</label>
              <input
                class="radioOption"
                type="radio"
                name="typeSite"
                value="occupe"
              />
              <label for="occupe">Occupe</label>
            </div>
          </div>
          <div class="infoProjet infoField">
            <div class="titleInfo">Année de référence (prix)</div>
            <input type="text" name="datePrixref" maxlength="4" />
          </div>
          <div class="infoProjet infoField">
            <div class="titleInfo">Coeffadaptation</div>
            <input type="text" name="coeffAdapt" maxlength="10" />
          </div>
          <div class="infoProjet infoField">
            <div class="titleInfo">Coeff raccordement</div>
            <select id="coeffRaccordement">
              <option value="">---</option>
              <option value="1">Alsace - 0.8</option>
            </select>
          </div>
          <div class="infoProjet infoField">
            <div class="titleInfo">Cat construction</div>
            <select
              id="categorieConstruction"
              onchange="show_catConstruction()"
            >
              <option value="">---</option>
              <option value="1">Batiment public</option>
            </select>
          </div>
          <div class="infoProjet infoField lineSousCatConstruction">
            <div class="titleInfo">Sous-cat construction</div>
            <select id="sousCategorieConstruction">
              <option value="">---</option>
              <option value="1">Gymnase</option>
            </select>
          </div>
          <div class="infoProjet infoField lineCaractDim">
            <div class="titleInfo">Caractéristiques dim</div>
            <select id="caractDim">
              <option value="">---</option>
              <option value="1">Caracteristique 1</option>
            </select>
          </div>
        </div>
        <div class="menuGestion">
          <div class="importButton">Gestion bibliothèque</div>
          <div class="exportButton">Exporter projet</div>
        </div>
      </div>
      <div class="container">
        <div id="titreLot">Titre Lot</div>
        <div class="lotCourant" id="lot_0">
          <div
            class="barreInsertion"
            id="barre_1"
            onclick="AjouterElement('barre_1', 'lot_0');"
          ></div>
          <div class="input-group titre1">
            <div class="input-group-prepend">
              <span class="input-group-text">I.</span>
            </div>
            <input type="text" class="form-control" placeholder="Titre 1" />
          </div>
          <div
            class="barreInsertion"
            id="barre_2"
            onclick="AjouterElement('barre_2', 'lot_0');"
          ></div>
          <div class="input-group titre2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">I.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 2"
              aria-label="titre2"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_3"
            onclick="AjouterElement('barre_3', 'lot_0');"
          ></div>
          <div class="input-group titre3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">1.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 3"
              aria-label="titre3"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_4"
            onclick="AjouterElement('barre_4', 'lot_0');"
          ></div>
          <div class="input-group titre4">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">1.1.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 4"
              aria-label="titre4"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_5"
            onclick="AjouterElement('barre_5', 'lot_0');"
          ></div>
          <div class="descriptif titre5">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">1.1.1.1</span>
              </div>
              <input
                type="text"
                class="form-control"
                placeholder="Ouvrage/Prestation"
                aria-label="titre5"
                aria-describedby="basic-addon1"
              />
            </div>
            <div class="input-group description">
              <textarea
                class="form-control"
                aria-label="With textarea"
                placeholder="Description"
              >
Ceci est un descriptif et en voici sa description.Ceci est un descriptif et en voici sa description.Ceci est un descriptif et en voici sa description.Ceci est un descriptif et en voici sa description</textarea
              >
            </div>
            <div class="input-group ligneChiffrage">
              <input
                type="text"
                aria-label="Localisation"
                class="form-control"
                placeholder="Localisation"
              />
              <input
                type="text"
                aria-label="Quantite"
                class="form-control"
                placeholder="Quantité"
              />
              <div class="input-group-prepend">
                <span class="input-group-text">m2</span>
              </div>
            </div>
          </div>
          <div
            class="barreInsertion"
            id="barre_6"
            onclick="AjouterElement('barre_6', 'lot_0');"
          ></div>
          <div class="input-group titre1">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">II.</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 1"
              aria-label="titre1"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_7"
            onclick="AjouterElement('barre_7', 'lot_0');"
          ></div>
          <div class="descriptif titre2">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">II.1</span>
              </div>
              <input
                type="text"
                class="form-control"
                placeholder="Generique"
                aria-label="titre2"
                aria-describedby="basic-addon1"
              />
            </div>
            <div class="input-group description">
              <textarea
                class="form-control"
                aria-label="With textarea"
                placeholder="Description"
              ></textarea>
            </div>
          </div>
          <div class="input-group titre2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">II.2</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 2"
              aria-label="titre2"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_8"
            onclick="AjouterElement('barre_8', 'lot_0');"
          ></div>
          <div class="input-group titre3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">2.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 3"
              aria-label="titre3"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_9"
            onclick="AjouterElement('barre_9', 'lot_0');"
          ></div>
          <div class="descriptif titre4">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">2.1.1</span>
              </div>
              <input
                type="text"
                class="form-control"
                placeholder="Ouvrage/Prestation"
                aria-label="titre4"
                aria-describedby="basic-addon1"
              />
            </div>
            <div class="input-group description">
              <textarea
                class="form-control"
                aria-label="With textarea"
                placeholder="Description"
              ></textarea>
            </div>
            <div class="input-group ligneChiffrage">
              <input
                type="text"
                aria-label="Localisation"
                class="form-control"
                placeholder="Localisation"
              />
              <input
                type="text"
                aria-label="Quantite"
                class="form-control"
                placeholder="Quantité"
              />
              <div class="input-group-prepend">
                <span class="input-group-text">m3</span>
              </div>
            </div>
            <div class="input-group ligneChiffrage">
              <input
                type="text"
                aria-label="Localisation"
                class="form-control"
                placeholder="Localisation"
              />
              <input
                type="text"
                aria-label="Quantite"
                class="form-control"
                placeholder="Quantité"
              />
              <div class="input-group-prepend">
                <span class="input-group-text">m3</span>
              </div>
            </div>
          </div>
          <div
            class="barreInsertion"
            id="barre_10"
            onclick="AjouterElement('barre_10', 'lot_0');"
          ></div>
        </div>
        <div
          class="lotCourant"
          id="lot_1"
          onclick="SuppressionChoixInsertionTitre();"
          style="display: none;"
        >
          <div
            class="barreInsertion"
            id="barre_11"
            onclick="AjouterElement('barre_11', 'lot_1');"
          ></div>
          <div class="input-group titre1">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">I.</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 1"
              aria-label="titre1"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_12"
            onclick="AjouterElement('barre_12', 'lot_1');"
          ></div>
          <div class="input-group titre2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">I.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 2"
              aria-label="titre2"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_13"
            onclick="AjouterElement('barre_13', 'lot_1');"
          ></div>
          <div class="input-group titre3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">1.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 3"
              aria-label="titre3"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_14"
            onclick="AjouterElement('barre_14', 'lot_1');"
          ></div>
          <div class="input-group titre4">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">1.1.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 4"
              aria-label="titre4"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_15"
            onclick="AjouterElement('barre_15', 'lot_1');"
          ></div>
          <div class="input-group titre1">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">II.</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 1"
              aria-label="titre1"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_16"
            onclick="AjouterElement('barre_16', 'lot_1');"
          ></div>
          <div class="descriptif titre2">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">II.1</span>
              </div>
              <input
                type="text"
                class="form-control"
                placeholder="Generique"
                aria-label="titre2"
                aria-describedby="basic-addon1"
              />
            </div>
            <div class="input-group description">
              <textarea
                class="form-control"
                aria-label="With textarea"
                placeholder="Description"
              ></textarea>
            </div>
          </div>
          <div class="input-group titre2">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">II.2</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 2"
              aria-label="titre2"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_17"
            onclick="AjouterElement('barre_17', 'lot_1');"
          ></div>
          <div class="input-group titre3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">2.1</span>
            </div>
            <input
              type="text"
              class="form-control"
              placeholder="Titre 3"
              aria-label="titre3"
              aria-describedby="basic-addon1"
            />
          </div>
          <div
            class="barreInsertion"
            id="barre_18"
            onclick="AjouterElement('barre_18', 'lot_1');"
          ></div>
        </div>
        <div id="ongletsLot">
          <div class="ongletLot" onclick="AfficherOnglet($('#lot_0'));">
            0
          </div>
          <div class="ongletLot" onclick="AfficherOnglet($('#lot_1'));">
            1
          </div>
          <div class="ongletLot" onclick="CreerOnglet();">+</div>
        </div>
      </div>
    </div>

    <script>
      test_select_descriptif = false; //permet de ne pas supprimer la selection d'un element à peine faite

      $(".container").first().click(unset_select_descriptif);
      $(".lineDescriptif").click(function () {
        select_descriptif(this);
      });
      $(".lineChapitre").click(function () {
        gestion_arbo_bdd(this);
      });
      $(".lineCategorie").click(function () {
        gestion_arbo_bdd(this);
      });
      $(".lineFamille").click(function () {
        gestion_arbo_bdd(this);
      });
      $(".lineSousFamille").click(function () {
        gestion_arbo_bdd(this);
      });

      function unset_select_descriptif() {
        if (!test_select_descriptif) {
          $(".selectDescriptif").removeClass("selectDescriptif");
        }
        test_select_descriptif = false;
      }

      function select_descriptif(element) {
        $(".selectDescriptif").removeClass("selectDescriptif");
        $(element).addClass("selectDescriptif");
        test_select_descriptif = true;
        //alert($(element).children(".idDescriptif").val());	//affiche l'idDescriptif selectionné
      }

      function gestion_menu_bdd(panel) {
        if (panel == "biblio") {
          $(".menuBiblio").css("color", "black");
          $(".menuInfos").css("color", "grey");
          $("#arboBDD").show();
          $("#infosProjet").hide();
        }

        if (panel == "infos") {
          $(".menuInfos").css("color", "black");
          $(".menuBiblio").css("color", "grey");
          $("#infosProjet").show();
          $("#arboBDD").hide();
        }
      }

      function apply_filter() {
        var filtre = $(".filtre").val();
        var array_show = new Array(),
          array_hide = new Array();

        switch (filtre) {
          case "generique":
            array_show = ["generique"];
            array_hide = ["ouvrage", "prestation"];
            break;
          case "ouvrage":
            array_show = ["ouvrage"];
            array_hide = ["generique", "prestation"];
            break;
          case "prestation":
            array_show = ["prestation"];
            array_hide = ["ouvrage", "generique"];
            break;
          default:
            array_show = ["generique", "ouvrage", "prestation"];
            array_hide = [];
        }

        for (var i = 0; i < array_show.length; i++) {
          $("." + array_show[i]).each(function () {
            $(this).show();
          });
        }
        for (var i = 0; i < array_hide.length; i++) {
          $("." + array_hide[i]).each(function () {
            $(this).hide();
          });
        }
      }

      function show_catConstruction() {
        var val = $("#categorieConstruction").val();

        if (val == "") {
          $(".lineSousCatConstruction").hide();
          $(".lineCaractDim").hide();
        } else {
          $(".lineSousCatConstruction").css("display", "flex");
          $(".lineCaractDim").css("display", "flex");
          //lien BDD
        }
      }

      function gestion_arbo_bdd(element) {
        //on range les différents niveaux de l'arborescence dans un tableau
        var ordre_arbo = new Map();
        ordre_arbo.set("lineChapitre", 1);
        ordre_arbo.set("lineCategorie", 2);
        ordre_arbo.set("lineFamille", 3);
        ordre_arbo.set("lineSousFamille", 4);

        //on détermine le rang de l'objet clické
        var classElement = $(element).attr("class").substr(8);
        var rangElement = ordre_arbo.get(classElement);

        //on détermine le type d'opération
        var spanArrow = $(element).children(".iconBDD");
        var classArrow = $(spanArrow).children(".arrow").attr("class");

        if (classArrow.includes("down")) var action = "remonter";
        else var action = "derouler";

        //on modifie la fleche
        if (action == "derouler")
          $(spanArrow).html('<i class="fas fa-caret-down arrow">');
        else $(spanArrow).html('<i class="fas fa-caret-right arrow">');

        //on détermine tous les objets de rangs directement supérieur ou égal à 5
        var oldElement = element;
        var nextElement = null;
        var classNextElement = null;
        var rangNextElement = null;
        var rangOldElement = null;
        do {
          nextElement = $(oldElement).next();
          classNextElement = $(nextElement).attr("class").substr(8);
          rangNextElement = ordre_arbo.get(classNextElement);

          if (classNextElement && rangNextElement == null) rangNextElement = 5;

          if (action == "derouler") {
            if (
              rangNextElement == rangElement + 1 ||
              (rangNextElement == 5 && rangOldElement == rangElement)
            ) {
              $(nextElement).css("display", "flex");
            }
          } else {
            if (rangNextElement > rangElement) {
              $(nextElement).css("display", "none");
            }
          }

          if (
            rangNextElement != null &&
            rangNextElement > rangElement &&
            rangNextElement != 5
          ) {
            //on modifie la fleche de l'élement enfant
            spanArrow = $(nextElement).children(".iconBDD");
            if (action == "remonter")
              $(spanArrow).html('<i class="fas fa-caret-right arrow">');
          }

          oldElement = nextElement;
          rangOldElement = rangNextElement;
        } while (rangNextElement > rangElement);
      }

      test_manageProjet = false;

      function display_manage_project() {
        if (!test_manageProjet) {
          $("#manageProjet").show();
          $("#arboBDD").hide();
          $("#menu").hide();
          $("#infosProjet").hide();
          $(".menuGestion").hide();
          test_manageProjet = true;
        } else {
          $("#manageProjet").hide();
          $("#arboBDD").show();
          $("#menu").show();
          $("#infosProjet").hide();
          $(".menuGestion").show();
          test_manageProjet = false;
        }
      }

      var barreInsertionNextId = 19;
      $(".container").last().click(SuppressionChoixInsertionTitre);
      var testChoixPresent = false;
      function AjouterElement(idPosition, idLotCourant) {
        //Si un descriptif a été sélectionné alors on l'insère directement dans l'arborescence
        if ($(".selectDescriptif") !== null) {
          if ($("#" + idPosition).prev() !== null) {
            //On créer le div du descriptif avec le stlye correspondant à sa place dans l'arbo
            var divInsertionDescriptif = document.createElement("div");

            var titreAuDessus = $("#" + idPosition).prev();
            if (!titreAuDessus.hasClass("descriptif")) {
              if (titreAuDessus.hasClass("titre1")) {
                divInsertionDescriptif.className = "descriptif titre2";
              } else if (titreAuDessus.hasClass("titre2")) {
                divInsertionDescriptif.className = "descriptif titre3";
              } else if (titreAuDessus.hasClass("titre3")) {
                divInsertionDescriptif.className = "descriptif titre4";
              } else if (titreAuDessus.hasClass("titre4")) {
                divInsertionDescriptif.className = "descriptif titre5";
              }
            } else {
              var classDescriptifAuDessus = titreAuDessus.attr("class");
              divInsertionDescriptif.className = classDescriptifAuDessus;
            }

            var divInputGroupTitre = document.createElement("div");
            divInputGroupTitre.className = "input-group";

            var divInputGroupPrependNumero = document.createElement("div");
            divInputGroupPrependNumero.className = "input-group-prepend";

            var spanInputGroupText = document.createElement("span");
            spanInputGroupText.className = "input-group-text";

            divInputGroupPrependNumero.appendChild(spanInputGroupText);

            var inputTitre = document.createElement("input");
            inputTitre.type = "text";
            inputTitre.className = "form-control";
            inputTitre.placeholder = "Descriptif";

            divInputGroupTitre.appendChild(divInputGroupPrependNumero);
            divInputGroupTitre.appendChild(inputTitre);

            var divInputGroupDescription = document.createElement("div");
            divInputGroupDescription.className = "input-group description";

            var textareaFormControl = document.createElement("textarea");
            textareaFormControl.className = "form-control";
            textareaFormControl.placeholder = "Description";
            //Appel AJAX pour récupérer la description

            divInputGroupDescription.appendChild(textareaFormControl);

            if (!$(".selectDescriptif").hasClass("generique")) {
              var divInputGroupLigneChiffrage = document.createElement("div");
              divInputGroupLigneChiffrage.className =
                "input-group ligneChiffrage";

              var inputLocalisation = document.createElement("input");
              inputLocalisation.type = "text";
              inputLocalisation.className = "form-control";
              inputLocalisation.placeholder = "Localisation";

              var inputQuantite = document.createElement("input");
              inputQuantite.type = "text";
              inputQuantite.className = "form-control";
              inputQuantite.placeholder = "Quantité";

              var divInputGroupPrependUnite = document.createElement("div");
              divInputGroupPrependUnite.className = "input-group-prepend";

              var spanInputGroupTextUnite = document.createElement("span");
              spanInputGroupTextUnite.className = "input-group-text";
              //Faut rajouter l'unité en AJAX

              divInputGroupPrependUnite.appendChild(spanInputGroupTextUnite);

              divInputGroupLigneChiffrage.appendChild(inputLocalisation);
              divInputGroupLigneChiffrage.appendChild(inputQuantite);
              divInputGroupLigneChiffrage.appendChild(
                divInputGroupPrependUnite
              );

              divInsertionDescriptif.appendChild(divInputGroupTitre);
              divInsertionDescriptif.appendChild(divInputGroupDescription);
              divInsertionDescriptif.appendChild(divInputGroupLigneChiffrage);

              $(divInsertionDescriptif).insertBefore($("#" + idPosition));

              //On insère une barre d'insertion au dessus du nouveau descriptif
              var divBarreInsertion = document.createElement("div");
              divBarreInsertion.className = "barreInsertion";
              divBarreInsertion.id = "barre_" + barreInsertionNextId;
              barreInsertionNextId++;
              var parent = divInsertionDescriptif.parentElement;
              parent.insertBefore(divBarreInsertion, divInsertionDescriptif);
              $("#" + divBarreInsertion.id).click(function () {
                AjouterElement(divBarreInsertion.id, parent.id);
              });

              //Appel de la fonction de numérotation de l'arborescence
              NumerotationArbo();
            } else {
              divInsertionDescriptif.appendChild(divInputGroupTitre);
              divInsertionDescriptif.appendChild(divInputGroupDescription);

              $(divInsertionDescriptif).insertBefore($("#" + idPosition));

              //On insère une barre d'insertion au dessus du nouveau descriptif
              var divBarreInsertion = document.createElement("div");
              divBarreInsertion.className = "barreInsertion";
              divBarreInsertion.id = "barre_" + barreInsertionNextId;
              barreInsertionNextId++;
              var parent = divInsertionDescriptif.parentElement;
              parent.insertBefore(divBarreInsertion, divInsertionDescriptif);
              $("#" + divBarreInsertion.id).click(function () {
                AjouterElement(divBarreInsertion.id, parent.id);
              });

              //Appel de la fonction de numérotation de l'arborescence
              NumerotationArbo();
            }
          }
        } else {
          //Sinon on propose d'insérer un titre du même niveau d'arboresence que le titre d'au dessus ou de celui d'en-dessous sous réserve d'existence
          var type1 = null;
          var type2 = null;
          var prev = $("#" + idPosition).prev();
          var next = $("#" + idPosition).next();
          if (prev !== null) {
            if (prev.hasClass("titre1")) {
              type1 = "titre1";
            } else if (prev.hasClass("titre2")) {
              type1 = "titre2";
            } else if (prev.hasClass("titre3")) {
              type1 = "titre3";
            } else if (prev.hasClass("titre4")) {
              type1 = "titre4";
            } else if (prev.hasClass("titre5")) {
              type1 = "titre5";
            }
          }
          if (next !== null) {
            if (next.hasClass("titre1")) {
              type2 = "titre1";
            } else if (next.hasClass("titre2")) {
              type2 = "titre2";
            } else if (next.hasClass("titre3")) {
              type2 = "titre3";
            } else if (next.hasClass("titre4")) {
              type2 = "titre4";
            } else if (next.hasClass("titre5")) {
              type2 = "titre5";
            }
          }

          if (type1 == type2) type2 = null;

          //On affiche un panneau demandant quel type de titre il veut afficher parmis les choix dispo
          var divInsertionTitre = document.createElement("div");
          divInsertionTitre.className = "divInsertionTitre";

          if (type1 !== null) {
            var divType1 = document.createElement("div");
            divType1.className = "sousDivInsertionTitre";
            switch (type1) {
              case "titre1":
                divType1.innerHTML = "Titre 1";
                break;
              case "titre2":
                divType1.innerHTML = "Titre 2";
                break;
              case "titre3":
                divType1.innerHTML = "Titre 3";
                break;
              case "titre4":
                divType1.innerHTML = "Titre 4";
                break;
              case "titre5":
                divType1.innerHTML = "Titre 5";
                break;
              default:
                break;
            }
            divInsertionTitre.appendChild(divType1);
          }
          if (type2 !== null) {
            var divType2 = document.createElement("div");
            divType2.className = "sousDivInsertionTitre";
            switch (type2) {
              case "titre1":
                divType2.innerHTML = "Titre 1";
                break;
              case "titre2":
                divType2.innerHTML = "Titre 2";
                break;
              case "titre3":
                divType2.innerHTML = "Titre 3";
                break;
              case "titre4":
                divType2.innerHTML = "Titre 4";
                break;
              case "titre5":
                divType2.innerHTML = "Titre 5";
                break;
              default:
                break;
            }
            divInsertionTitre.appendChild(divType2);
          }

          if (type1 == null || type2 == null)
            divInsertionTitre.style.height = "25px";

          var nodePositionRef = document.getElementById(idPosition);
          var parent = nodePositionRef.parentNode;
          parent.insertBefore(divInsertionTitre, nodePositionRef);

          $(".sousDivInsertionTitre").click(function () {
            AjouterTitre(this);
          });

          testChoixPresent = true;
        }
      }

      function SuppressionChoixInsertionTitre() {
        if (!testChoixPresent) $(".divInsertionTitre").remove();
        testChoixPresent = false;
      }

      function AjouterTitre(evt) {
        var titleClassName = evt.innerHTML.replace(" ", "").toLowerCase();
        //On ajoute le titre avec le bon style
        var divNewTitle = document.createElement("div");
        divNewTitle.className = "input-group " + titleClassName;

        var divInputPrepend = document.createElement("div");
        divInputPrepend.className = "input-group-prepend";

        var spanPrepend = document.createElement("span");
        spanPrepend.className = "input-group-text";

        divInputPrepend.appendChild(spanPrepend);

        var inputTitle = document.createElement("input");
        inputTitle.type = "text";
        inputTitle.className = "form-control";
        inputTitle.placeholder = evt.innerHTML;

        divNewTitle.appendChild(divInputPrepend);
        divNewTitle.appendChild(inputTitle);

        var parent = evt.parentNode.parentNode;
        parent.insertBefore(divNewTitle, evt.parentNode);

        //On insère une barre d'insertion au-dessus du nouveau titre
        var divBarreInsertion = document.createElement("div");
        divBarreInsertion.className = "barreInsertion";
        divBarreInsertion.id = "barre_" + barreInsertionNextId;
        barreInsertionNextId++;
        parent.insertBefore(divBarreInsertion, divNewTitle);
        $("#" + divBarreInsertion.id).click(function () {
          AjouterElement(divBarreInsertion.id, parent.id);
        });

        //On supprime le panneau de choix des titres
        $(".divInsertionTitre").remove();

        //Appel de la fonction de numérotation de l'arborescence
        NumerotationArbo();
      }

      function NumerotationArbo() {
        var numTitre1 = 0;
        var numTitre2 = 0;
        var numTitre3 = 0;
        var numTitre4 = 0;
        var numTitre5 = 0;
        $(".input-group").each(function () {
          if (
            !$(this).hasClass("description") &&
            !$(this).hasClass("ligneChiffrage")
          ) {
            if ($(this).parent().hasClass("descriptif")) {
              if ($(this).parent().hasClass("titre1")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre1++;
                numeroTitre.html(toRoman(numTitre1) + ".");
                numTitre2 = 0;
                numTitre3 = 0;
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).parent().hasClass("titre2")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre2++;
                numeroTitre.html(toRoman(numTitre1) + "." + numTitre2);
                numTitre3 = 0;
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).parent().hasClass("titre3")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre3++;
                numeroTitre.html(numTitre2 + "." + numTitre3);
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).parent().hasClass("titre4")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre4++;
                numeroTitre.html(numTitre2 + "." + numTitre3 + "." + numTitre4);
                numTitre5 = 0;
              } else if ($(this).parent().hasClass("titre5")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre5++;
                numeroTitre.html(
                  numTitre2 +
                    "." +
                    numTitre3 +
                    "." +
                    numTitre4 +
                    "." +
                    numTitre5
                );
              }
            } else {
              if ($(this).hasClass("titre1")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre1++;
                numeroTitre.html(toRoman(numTitre1) + ".");
                numTitre2 = 0;
                numTitre3 = 0;
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).hasClass("titre2")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre2++;
                numeroTitre.html(toRoman(numTitre1) + "." + numTitre2);
                numTitre3 = 0;
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).hasClass("titre3")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre3++;
                numeroTitre.html(numTitre2 + "." + numTitre3);
                numTitre4 = 0;
                numTitre5 = 0;
              } else if ($(this).hasClass("titre4")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre4++;
                numeroTitre.html(numTitre2 + "." + numTitre3 + "." + numTitre4);
                numTitre5 = 0;
              } else if ($(this).hasClass("titre5")) {
                var numeroTitre = $(this).children(":first").children(":first"); //On récupère le span du chiffre romain
                numTitre5++;
                numeroTitre.html(
                  numTitre2 +
                    "." +
                    numTitre3 +
                    "." +
                    numTitre4 +
                    "." +
                    numTitre5
                );
              }
            }
          }
        });
      }

      function AfficherOnglet(lotAfficher) {
        $(".lotCourant").hide();
        lotAfficher.show();
      }

      function CreerOnglet() {}

      function toRoman(num) {
        if (isNaN(num)) return NaN;
        var digits = String(+num).split(""),
          key = [
            "",
            "C",
            "CC",
            "CCC",
            "CD",
            "D",
            "DC",
            "DCC",
            "DCCC",
            "CM",
            "",
            "X",
            "XX",
            "XXX",
            "XL",
            "L",
            "LX",
            "LXX",
            "LXXX",
            "XC",
            "",
            "I",
            "II",
            "III",
            "IV",
            "V",
            "VI",
            "VII",
            "VIII",
            "IX",
          ],
          roman = "",
          i = 3;
        while (i--) roman = (key[+digits.pop() + i * 10] || "") + roman;
        return Array(+digits.join("") + 1).join("M") + roman;
      }
    </script>
  </body>
</html>
